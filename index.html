<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Registro de √Ålbumes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background: #f8f9fa;
            color: #333;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        select,
        button {
            margin: 5px;
            padding: 6px 10px;
            border-radius: 4px;
            border: 1px solid #aaa;
            font-size: 14px;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background: #0056b3;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            table-layout: fixed; /* üîπ Para respetar los anchos */
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            vertical-align: middle;
            word-wrap: break-word;
        }

        /* üìè Columna de Foto m√°s angosta */
        th:first-child,
        td:first-child {
            width: 60px;
        }

        /* üìè Columna de √Ålbum m√°s ancha */
        th:nth-child(2),
        td:nth-child(2) {
            width: 250px; /* üîπ Ancho aumentado */
        }

        th {
            background: #007bff;
            color: white;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        select.estado {
            width: 100%;
            box-sizing: border-box;
            padding: 6px;
        }

        #resumen {
            font-weight: bold;
            font-size: 1.1em;
            text-align: right;
            margin-top: 10px;
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }

        .acciones button {
            margin: 2px;
        }

        /* üîπ Imagen m√°s peque√±a */
        img.preview {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 5px;
            border: 1px solid #ccc;
            display: block;
            margin: 3px auto;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        img.preview:hover {
            transform: scale(1.3);
        }

        /* üîç Modal para ver imagen en grande */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .modal-img {
            max-width: 90vw;
            max-height: 70vh;
            border-radius: 8px;
        }

        .modal-buttons {
            margin-top: 10px;
        }

        .modal-buttons button {
            margin: 5px;
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
            cursor: pointer;
        }

        .modal-buttons button:hover {
            background: #0056b3;
        }
    </style>
</head>

<body>

    <h1>üì¶ Registro de √Ålbumes</h1>

    <div style="text-align:center;">
        <label for="listaSelect">Seleccionar lista:</label>
        <select id="listaSelect" onchange="cambiarLista()"></select>
        <button onclick="nuevaLista()">‚ûï Nueva Lista</button>
    </div>

    <table id="tabla">
        <thead>
            <tr>
                <th>Foto</th>
                <th>√Ålbum</th>
                <th>Cantidad</th>
                <th>Precio Unitario ($)</th>
                <th>Total ($)</th>
                <th>Pago ($)</th>
                <th>Fecha de Pago</th>
                <th>Deuda ($)</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="tablaBody"></tbody>
    </table>

    <div style="margin-bottom: 10px;">
        <button onclick="agregarFila()">‚ûï Agregar fila</button>
        <button onclick="guardarDatos()">üíæ Guardar</button>
        <button onclick="borrarDatos()">üóëÔ∏è Borrar lista</button>
    </div>

    <div id="resumen">
        üí∞ Total General: $0 &nbsp;&nbsp;|&nbsp;&nbsp;
        üíµ Total Pagos: $0 &nbsp;&nbsp;|&nbsp;&nbsp;
        ‚ùó Total Deuda: $0
    </div>

    <script>
        const tablaBody = document.getElementById("tablaBody");
        const resumen = document.getElementById("resumen");
        const listaSelect = document.getElementById("listaSelect");

        let listas = JSON.parse(localStorage.getItem("listasNombres")) || ["Lista 1"];
        let listaActual = localStorage.getItem("listaActual") || "Lista 1";

        function cargarListas() {
            listaSelect.innerHTML = "";
            listas.forEach(nombre => {
                const opt = document.createElement("option");
                opt.value = nombre;
                opt.textContent = nombre;
                if (nombre === listaActual) opt.selected = true;
                listaSelect.appendChild(opt);
            });
            cargarDatos();
        }

        function nuevaLista() {
            const nombre = prompt("Nombre de la nueva lista:");
            if (nombre && !listas.includes(nombre)) {
                listas.push(nombre);
                localStorage.setItem("listasNombres", JSON.stringify(listas));
                listaActual = nombre;
                localStorage.setItem("listaActual", listaActual);
                cargarListas();
            } else if (listas.includes(nombre)) {
                alert("‚ùó Esa lista ya existe.");
            }
        }

        function cambiarLista() {
            listaActual = listaSelect.value;
            localStorage.setItem("listaActual", listaActual);
            cargarDatos();
        }

        function agregarFila(data = {}) {
            const fila = document.createElement("tr");
            fila.innerHTML = `
        <td>
            <input type="file" accept="image/*" onchange="mostrarImagen(this)" ${data.imagen ? 'style="display:none;"' : ''}>
            ${data.imagen ? `<img class="preview" src="${data.imagen}" alt="">` : ""}
        </td>
        <td><input type="text" value="${data.articulo || ''}" onchange="actualizarTotales()"></td>
        <td><input type="number" value="${data.cantidad || 0}" min="0" onchange="actualizarTotales()"></td>
        <td><input type="number" value="${data.precio || 0}" min="0" onchange="actualizarTotales()"></td>
        <td class="total">$0</td>
        <td><input type="number" value="${data.pago || 0}" min="0" onchange="actualizarTotales()"></td>
        <td><input type="date" value="${data.fecha || ''}" onchange="actualizarTotales()"></td>
        <td class="deuda">$0</td>
        <td>
            <select class="estado">
                <option ${data.estado === "Pagado" ? "selected" : ""}>Pagado</option>
                <option ${data.estado === "No Pagado" ? "selected" : ""}>No Pagado</option>
            </select>
        </td>
        <td class="acciones"><button onclick="eliminarFila(this)">‚ùå</button></td>
    `;
            tablaBody.appendChild(fila);

            const img = fila.querySelector("img");
            const input = fila.querySelector("input[type='file']");
            if (img && input) activarCambioImagen(img, input);

            actualizarTotales();
        }

        // ‚úÖ Mostrar imagen y permitir cambiarla
        function mostrarImagen(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    let img = input.parentElement.querySelector("img");
                    if (!img) {
                        img = document.createElement("img");
                        img.classList.add("preview");
                        input.parentElement.appendChild(img);
                    }
                    img.src = e.target.result;
                    input.style.display = "none";
                    activarCambioImagen(img, input);
                };
                reader.readAsDataURL(file);
            }
        }

        // ‚úÖ Modal para ampliar y cambiar imagen
        function activarCambioImagen(img, input) {
            img.onclick = function () {
                const modal = document.createElement("div");
                modal.classList.add("modal");

                modal.innerHTML = `
                <div class="modal-content">
                    <img src="${img.src}" class="modal-img" alt="">
                    <div class="modal-buttons">
                        <button class="cambiar-btn">Cambiar imagen</button>
                        <button class="cerrar-btn">Cerrar</button>
                    </div>
                </div>
            `;

                document.body.appendChild(modal);

                // Cerrar modal
                modal.querySelector(".cerrar-btn").onclick = () => modal.remove();

                // Cambiar imagen
                modal.querySelector(".cambiar-btn").onclick = () => {
                    const tempInput = document.createElement("input");
                    tempInput.type = "file";
                    tempInput.accept = "image/*";
                    tempInput.onchange = function () {
                        const file = tempInput.files[0];
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            img.src = e.target.result;
                            input.style.display = "none";
                            modal.querySelector(".modal-img").src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    };
                    tempInput.click();
                };
            };
        }

        function eliminarFila(boton) {
            boton.closest("tr").remove();
            actualizarTotales();
        }

        function actualizarTotales() {
            let totalGeneral = 0;
            let totalPagos = 0;
            let totalDeuda = 0;

            const filas = tablaBody.querySelectorAll("tr");
            filas.forEach(fila => {
                const cantidad = parseFloat(fila.children[2].children[0].value) || 0;
                const precio = parseFloat(fila.children[3].children[0].value) || 0;
                const pago = parseFloat(fila.children[5].children[0].value) || 0;

                const total = cantidad * precio;
                const deuda = total - pago;

                fila.children[4].textContent = `$${total.toFixed(2)}`;
                fila.children[7].textContent = `$${deuda.toFixed(2)}`;

                totalGeneral += total;
                totalPagos += pago;
                totalDeuda += deuda;
            });

            resumen.innerHTML = `
        üí∞ Total General: $${totalGeneral.toFixed(2)} &nbsp;&nbsp;|&nbsp;&nbsp;
        üíµ Total Pagos: $${totalPagos.toFixed(2)} &nbsp;&nbsp;|&nbsp;&nbsp;
        ‚ùó Total Deuda: $${totalDeuda.toFixed(2)}
    `;
        }

        function guardarDatos() {
            const filas = tablaBody.querySelectorAll("tr");
            const datos = [];

            filas.forEach(fila => {
                const img = fila.children[0].querySelector("img") ? fila.children[0].querySelector("img").src : "";
                datos.push({
                    imagen: img,
                    articulo: fila.children[1].children[0].value,
                    cantidad: fila.children[2].children[0].value,
                    precio: fila.children[3].children[0].value,
                    pago: fila.children[5].children[0].value,
                    fecha: fila.children[6].children[0].value,
                    estado: fila.children[8].children[0].value
                });
            });

            localStorage.setItem("registroArticulos_" + listaActual, JSON.stringify(datos));
            alert("‚úÖ Datos guardados en " + listaActual);
        }

        function cargarDatos() {
            tablaBody.innerHTML = "";
            const datos = JSON.parse(localStorage.getItem("registroArticulos_" + listaActual)) || [];
            datos.forEach(fila => agregarFila(fila));
            actualizarTotales();
        }

        function borrarDatos() {
            if (confirm("¬øSeguro que deseas borrar todos los registros de " + listaActual + "?")) {
                localStorage.removeItem("registroArticulos_" + listaActual);
                tablaBody.innerHTML = "";
                actualizarTotales();
            }
        }

        cargarListas();
    </script>

</body>
</html>
